<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã©ã“ã«ç½®ã„ãŸã£ã‘ï¼ŸæŒã¡ç‰©ãƒ­ã‚±ãƒ¼ã‚¿ãƒ¼ | æ¢ã—ç‰©ã‚¼ãƒ­ç”Ÿæ´»</title>
    <meta name="description" content="å®¶ä¸­ã®æŒã¡ç‰©ã‚’ã‚¹ãƒãƒ›ã§ç®¡ç†ã€‚ã©ã“ã«ç½®ã„ãŸã‹ä¸€ç¬ã§åˆ†ã‹ã‚‹ç„¡æ–™ã®æ•´ç†æ•´é “ã‚¢ãƒ—ãƒªã€‚QRã‚³ãƒ¼ãƒ‰å°åˆ·å¯¾å¿œã€‚">
    
    <!-- OGPè¨­å®š -->
    <meta property="og:title" content="ã©ã“ã«ç½®ã„ãŸã£ã‘ï¼ŸæŒã¡ç‰©ãƒ­ã‚±ãƒ¼ã‚¿ãƒ¼">
    <meta property="og:description" content="æ¢ã—ç‰©ã®æ™‚é–“ã‚’ã‚¼ãƒ­ã«ï¼æŒã¡ç‰©ã®å ´æ‰€ã‚’éšå±¤ç®¡ç†ã§ãã‚‹ç„¡æ–™ã‚¢ãƒ—ãƒª">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://appadaycreator.github.io/item-locator/">
    <meta property="og:image" content="https://appadaycreator.github.io/item-locator/ogp.png">
    <meta property="og:site_name" content="ã©ã“ã«ç½®ã„ãŸã£ã‘ï¼Ÿ">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@appadaycreator">
    
    <!-- PWAè¨­å®š -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#4A90E2">
    <link rel="apple-touch-icon" href="icon-192.png">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="favicon.png">
    
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-TXQGZRF9');</script>
    <!-- End Google Tag Manager -->
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: linear-gradient(135deg, #4A90E2 0%, #357ABD 100%);
            color: white;
            padding: 30px 0;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h1 {
            font-size: 2em;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.1em;
            opacity: 0.9;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 30px;
            margin-top: 30px;
        }
        
        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
        
        .card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 2px 15px rgba(0,0,0,0.08);
        }
        
        .card h2 {
            color: #4A90E2;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }
        
        input, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e6ed;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: #4A90E2;
        }
        
        .btn {
            background: #4A90E2;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-block;
            text-decoration: none;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        
        .btn:hover {
            background: #357ABD;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(74, 144, 226, 0.3);
        }
        
        .btn-secondary {
            background: #6c757d;
        }
        
        .btn-secondary:hover {
            background: #5a6268;
        }
        
        .btn-success {
            background: #28a745;
        }
        
        .btn-success:hover {
            background: #218838;
        }
        
        .tree-view {
            margin-top: 20px;
        }
        
        .tree-item {
            padding: 10px;
            margin: 5px 0;
            background: #f8f9fa;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            border-left: 4px solid transparent;
        }
        
        .tree-item:hover {
            background: #e9ecef;
            border-left-color: #4A90E2;
        }
        
        .tree-item.selected {
            background: #e3f2fd;
            border-left-color: #4A90E2;
        }
        
        .tree-children {
            margin-left: 20px;
            margin-top: 5px;
        }
        
        .search-result {
            padding: 15px;
            background: #fffbf0;
            border: 2px solid #ffd700;
            border-radius: 8px;
            margin: 10px 0;
            animation: highlight 0.5s ease;
        }
        
        @keyframes highlight {
            0% { transform: scale(0.95); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .stat-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #4A90E2;
        }
        
        .stat-label {
            color: #666;
            font-size: 0.9em;
        }
        
        .qr-container {
            text-align: center;
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        #qrcode {
            margin: 20px auto;
        }
        
        .affiliate-section {
            margin-top: 40px;
            padding: 25px;
            background: #f0f8ff;
            border-radius: 12px;
            border: 2px dashed #4A90E2;
        }
        
        .affiliate-section h3 {
            color: #4A90E2;
            margin-bottom: 15px;
        }
        
        .affiliate-links {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .affiliate-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            transition: transform 0.3s;
        }
        
        .affiliate-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .footer-links {
            margin-top: 40px;
            padding: 20px;
            background: #2c3e50;
            border-radius: 8px;
            text-align: center;
        }
        
        .footer-links a {
            color: white;
            text-decoration: none;
            margin: 0 15px;
            font-size: 0.9em;
        }
        
        .footer-links a:hover {
            text-decoration: underline;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }
        
        .modal-content {
            position: relative;
            background: white;
            width: 90%;
            max-width: 600px;
            margin: 50px auto;
            padding: 30px;
            border-radius: 12px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .close {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 30px;
            cursor: pointer;
            color: #999;
        }
        
        .close:hover {
            color: #333;
        }
        
        .share-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .share-btn {
            padding: 10px 20px;
            border-radius: 8px;
            text-decoration: none;
            color: white;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .share-twitter { background: #1DA1F2; }
        .share-line { background: #00B900; }
        .share-facebook { background: #1877F2; }
    </style>
</head>
<body>
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TXQGZRF9"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
    
    <header>
        <h1>ğŸ“¦ ã©ã“ã«ç½®ã„ãŸã£ã‘ï¼ŸæŒã¡ç‰©ãƒ­ã‚±ãƒ¼ã‚¿ãƒ¼</h1>
        <p class="subtitle">æ¢ã—ç‰©ã®æ™‚é–“ã‚’ã‚¼ãƒ­ã«ï¼ã‚¹ãƒãƒ›ã§ç°¡å˜ç®¡ç†</p>
    </header>
    
    <div class="container">
        <div class="stats">
            <div class="stat-card">
                <div class="stat-number" id="totalItems">0</div>
                <div class="stat-label">ç™»éŒ²ã‚¢ã‚¤ãƒ†ãƒ </div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalLocations">0</div>
                <div class="stat-label">åç´å ´æ‰€</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="savedTime">0</div>
                <div class="stat-label">ç¯€ç´„æ™‚é–“(åˆ†)</div>
            </div>
        </div>
        
        <div class="main-content">
            <div class="card">
                <h2>ğŸ” ã‚¢ã‚¤ãƒ†ãƒ æ¤œç´¢</h2>
                <div class="form-group">
                    <input type="text" id="searchInput" placeholder="æ¢ã—ãŸã„ã‚‚ã®ã‚’å…¥åŠ›...">
                </div>
                <button class="btn" onclick="searchItems()">æ¤œç´¢</button>
                <div id="searchResults"></div>
                
                <h2 style="margin-top: 30px;">â• æ–°è¦ç™»éŒ²</h2>
                <div class="form-group">
                    <label>åç´å ´æ‰€ï¼ˆè¦ªï¼‰</label>
                    <select id="parentLocation">
                        <option value="">æ–°è¦ä½œæˆ</option>
                    </select>
                    <input type="text" id="newParentLocation" placeholder="ä¾‹ï¼šãƒªãƒ“ãƒ³ã‚°ã®æ£š" style="margin-top: 10px; display: none;">
                </div>
                
                <div class="form-group">
                    <label>è©³ç´°å ´æ‰€</label>
                    <input type="text" id="detailLocation" placeholder="ä¾‹ï¼š2æ®µç›®å·¦å´">
                </div>
                
                <div class="form-group">
                    <label>ã‚¢ã‚¤ãƒ†ãƒ å</label>
                    <input type="text" id="itemName" placeholder="ä¾‹ï¼šå–æ‰±èª¬æ˜æ›¸">
                </div>
                
                <div class="form-group">
                    <label>ãƒ¡ãƒ¢ï¼ˆä»»æ„ï¼‰</label>
                    <input type="text" id="itemMemo" placeholder="ä¾‹ï¼š2023å¹´è³¼å…¥ã®æƒé™¤æ©Ÿ">
                </div>
                
                <button class="btn" onclick="addItem()">ç™»éŒ²ã™ã‚‹</button>
                <button class="btn btn-secondary" onclick="generateQR()">QRã‚³ãƒ¼ãƒ‰ç”Ÿæˆ</button>
            </div>
            
            <div class="card">
                <h2>ğŸ“ åç´ãƒãƒƒãƒ—</h2>
                <div id="treeView" class="tree-view"></div>
                
                <div style="margin-top: 30px;">
                    <button class="btn btn-success" onclick="shareResults()">ğŸ“± SNSã§ã‚·ã‚§ã‚¢</button>
                    <button class="btn btn-secondary" onclick="compareWithFriends()">ğŸ‘¥ å‹é”ã¨æ¯”è¼ƒ</button>
                    <button class="btn btn-secondary" onclick="showHistory()">ğŸ“Š å±¥æ­´ã‚’è¦‹ã‚‹</button>
                </div>
            </div>
        </div>
        
        <div class="affiliate-section">
            <h3>ğŸ›ï¸ ãŠã™ã™ã‚åç´ã‚°ãƒƒã‚º</h3>
            <p>æ•´ç†æ•´é “ã‚’ã‚‚ã£ã¨ä¾¿åˆ©ã«ï¼äººæ°—ã®åç´ã‚¢ã‚¤ãƒ†ãƒ ã‚’ãƒã‚§ãƒƒã‚¯</p>
            <div class="affiliate-links">
                <div class="affiliate-card">
                    <h4>ç„¡å°è‰¯å“</h4>
                    <p>ã‚·ãƒ³ãƒ—ãƒ«ã§ä½¿ã„ã‚„ã™ã„åç´ãƒœãƒƒã‚¯ã‚¹</p>
                    <a href="#" class="btn" onclick="trackAffiliate('muji')">è©³ç´°ã‚’è¦‹ã‚‹</a>
                </div>
                <div class="affiliate-card">
                    <h4>IKEA</h4>
                    <p>åŒ—æ¬§ãƒ‡ã‚¶ã‚¤ãƒ³ã®åç´å®¶å…·</p>
                    <a href="#" class="btn" onclick="trackAffiliate('ikea')">è©³ç´°ã‚’è¦‹ã‚‹</a>
                </div>
                <div class="affiliate-card">
                    <h4>ãƒ©ãƒ™ãƒ«ãƒ—ãƒªãƒ³ã‚¿ãƒ¼</h4>
                    <p>åç´å ´æ‰€ã‚’ãƒ©ãƒ™ãƒªãƒ³ã‚°</p>
                    <a href="#" class="btn" onclick="trackAffiliate('label')">è©³ç´°ã‚’è¦‹ã‚‹</a>
                </div>
            </div>
        </div>
        
        <div class="footer-links">
            <a href="#" onclick="showPrivacyPolicy()">ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼</a>
            <a href="#" onclick="showDisclaimer()">å…è²¬äº‹é …</a>
            <a href="#" onclick="showContact()">ãŠå•ã„åˆã‚ã›</a>
        </div>
    </div>
    
    <!-- QRã‚³ãƒ¼ãƒ‰è¡¨ç¤ºãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="qrModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('qrModal')">&times;</span>
            <h2>QRã‚³ãƒ¼ãƒ‰å°åˆ·</h2>
            <div class="qr-container">
                <div id="qrcode"></div>
                <p>ã“ã®QRã‚³ãƒ¼ãƒ‰ã‚’åç´å ´æ‰€ã«è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„</p>
                <button class="btn" onclick="printQR()">å°åˆ·ã™ã‚‹</button>
            </div>
        </div>
    </div>
    
    <!-- SNSã‚·ã‚§ã‚¢ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="shareModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('shareModal')">&times;</span>
            <h2>SNSã§ã‚·ã‚§ã‚¢</h2>
            <p>ã‚ãªãŸã®æ•´ç†æ•´é “ã®æˆæœã‚’ã‚·ã‚§ã‚¢ã—ã¾ã—ã‚‡ã†ï¼</p>
            <div class="share-buttons">
                <a href="#" class="share-btn share-twitter" onclick="shareToTwitter()">ğŸ¦ Twitter</a>
                <a href="#" class="share-btn share-line" onclick="shareToLine()">ğŸ’¬ LINE</a>
                <a href="#" class="share-btn share-facebook" onclick="shareToFacebook()">ğŸ“˜ Facebook</a>
            </div>
        </div>
    </div>
    
    <!-- å‹é”ã¨æ¯”è¼ƒãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="compareModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('compareModal')">&times;</span>
            <h2>å‹é”ã¨æ¯”è¼ƒ</h2>
            <div class="stats">
                <div class="stat-card">
                    <div class="stat-label">ã‚ãªãŸã®ç™»éŒ²æ•°</div>
                    <div class="stat-number" id="yourItems">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">å¹³å‡ç™»éŒ²æ•°</div>
                    <div class="stat-number">87</div>
                </div>
            </div>
            <p style="margin-top: 20px;">å‹é”ã‚³ãƒ¼ãƒ‰ã‚’å…±æœ‰ã—ã¦ã€æ•´ç†æ•´é “ãƒ¬ãƒ™ãƒ«ã‚’æ¯”è¼ƒã—ã‚ˆã†ï¼</p>
            <div class="form-group">
                <label>ã‚ãªãŸã®å‹é”ã‚³ãƒ¼ãƒ‰</label>
                <input type="text" id="friendCode" readonly>
                <button class="btn" onclick="copyFriendCode()">ã‚³ãƒ”ãƒ¼</button>
            </div>
        </div>
    </div>
    
    <!-- ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="privacyModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('privacyModal')">&times;</span>
            <h2>ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼</h2>
            <p>å½“ã‚µãƒ¼ãƒ“ã‚¹ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ã‚’å°Šé‡ã—ã€å€‹äººæƒ…å ±ã®ä¿è­·ã«åŠªã‚ã¾ã™ã€‚</p>
            <h3>åé›†ã™ã‚‹æƒ…å ±</h3>
            <ul>
                <li>ç™»éŒ²ã•ã‚ŒãŸã‚¢ã‚¤ãƒ†ãƒ ã¨åç´å ´æ‰€ã®æƒ…å ±</li>
                <li>ã‚¢ã‚¯ã‚»ã‚¹è§£æã®ãŸã‚ã®åŒ¿åæƒ…å ±</li>
            </ul>
            <h3>æƒ…å ±ã®åˆ©ç”¨ç›®çš„</h3>
            <ul>
                <li>ã‚µãƒ¼ãƒ“ã‚¹ã®æä¾›ãƒ»æ”¹å–„</li>
                <li>çµ±è¨ˆæƒ…å ±ã®ä½œæˆ</li>
            </ul>
            <h3>ãƒ‡ãƒ¼ã‚¿ã®ä¿å­˜</h3>
            <p>ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ã¯ã€ãŠä½¿ã„ã®ç«¯æœ«ã®ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜ã•ã‚Œã€å¤–éƒ¨ã‚µãƒ¼ãƒãƒ¼ã«ã¯é€ä¿¡ã•ã‚Œã¾ã›ã‚“ã€‚</p>
        </div>
    </div>
    
    <!-- å…è²¬äº‹é …ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="disclaimerModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('disclaimerModal')">&times;</span>
            <h2>å…è²¬äº‹é …</h2>
            <p>æœ¬ã‚µãƒ¼ãƒ“ã‚¹ã®åˆ©ç”¨ã«ã‚ˆã‚Šç”Ÿã˜ãŸã„ã‹ãªã‚‹æå®³ã«ã¤ã„ã¦ã‚‚ã€é‹å–¶è€…ã¯ä¸€åˆ‡ã®è²¬ä»»ã‚’è² ã„ã¾ã›ã‚“ã€‚</p>
            <ul>
                <li>ãƒ‡ãƒ¼ã‚¿ã®æ¶ˆå¤±ãƒ»ç ´æ</li>
                <li>ã‚µãƒ¼ãƒ“ã‚¹ã®ä¸­æ–­ãƒ»åœæ­¢</li>
                <li>ç™»éŒ²æƒ…å ±ã®æ­£ç¢ºæ€§</li>
            </ul>
            <p>æœ¬ã‚µãƒ¼ãƒ“ã‚¹ã¯ç„¡æ–™ã§æä¾›ã•ã‚Œã¦ãŠã‚Šã€äºˆå‘Šãªãå¤‰æ›´ãƒ»çµ‚äº†ã™ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚</p>
        </div>
    </div>
    
    <!-- ãŠå•ã„åˆã‚ã›ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="contactModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('contactModal')">&times;</span>
            <h2>ãŠå•ã„åˆã‚ã›</h2>
            <form onsubmit="submitContact(event)">
                <div class="form-group">
                    <label>ãŠåå‰</label>
                    <input type="text" id="contactName" required>
                </div>
                <div class="form-group">
                    <label>ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label>
                    <input type="email" id="contactEmail" required>
                </div>
                <div class="form-group">
                    <label>ãŠå•ã„åˆã‚ã›å†…å®¹</label>
                    <textarea id="contactMessage" rows="5" style="width: 100%; padding: 10px; border: 2px solid #e0e6ed; border-radius: 8px;" required></textarea>
                </div>
                <button type="submit" class="btn">é€ä¿¡</button>
            </form>
        </div>
    </div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script>
        // ãƒ‡ãƒ¼ã‚¿æ§‹é€ 
        let locations = JSON.parse(localStorage.getItem('locations') || '{}');
        let items = JSON.parse(localStorage.getItem('items') || '[]');
        let history = JSON.parse(localStorage.getItem('history') || '[]');
        
        // åˆæœŸåŒ–
        function init() {
            updateStats();
            renderTree();
            updateParentSelect();
            generateFriendCode();
            
            // PWA Service Workerç™»éŒ²
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('sw.js');
            }
        }
        
        // çµ±è¨ˆæƒ…å ±æ›´æ–°
        function updateStats() {
            document.getElementById('totalItems').textContent = items.length;
            document.getElementById('totalLocations').textContent = Object.keys(locations).length;
            document.getElementById('savedTime').textContent = Math.floor(items.length * 3); // 1ã‚¢ã‚¤ãƒ†ãƒ 3åˆ†ã®ç¯€ç´„ã¨ä»®å®š
            document.getElementById('yourItems').textContent = items.length;
        }
        
        // è¦ªå ´æ‰€ã‚»ãƒ¬ã‚¯ãƒˆæ›´æ–°
        function updateParentSelect() {
            const select = document.getElementById('parentLocation');
            select.innerHTML = '<option value="">æ–°è¦ä½œæˆ</option>';
            
            Object.keys(locations).forEach(loc => {
                const option = document.createElement('option');
                option.value = loc;
                option.textContent = loc;
                select.appendChild(option);
            });
        }
        
        // è¦ªå ´æ‰€é¸æŠæ™‚ã®å‡¦ç†
        document.getElementById('parentLocation').addEventListener('change', function() {
            const newParent = document.getElementById('newParentLocation');
            if (this.value === '') {
                newParent.style.display = 'block';
            } else {
                newParent.style.display = 'none';
            }
        });
        
        // ã‚¢ã‚¤ãƒ†ãƒ è¿½åŠ 
        function addItem() {
            const parentSelect = document.getElementById('parentLocation');
            const newParentInput = document.getElementById('newParentLocation');
            const detailLocation = document.getElementById('detailLocation').value;
            const itemName = document.getElementById('itemName').value;
            const itemMemo = document.getElementById('itemMemo').value;
            
            if (!itemName || !detailLocation) {
                alert('è©³ç´°å ´æ‰€ã¨ã‚¢ã‚¤ãƒ†ãƒ åã¯å¿…é ˆã§ã™');
                return;
            }
            
            let parentLocation = parentSelect.value;
            if (!parentLocation) {
                parentLocation = newParentInput.value;
                if (!parentLocation) {
                    alert('åç´å ´æ‰€ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                    return;
                }
            }
            
            // å ´æ‰€ã®éšå±¤æ§‹é€ ã‚’ä½œæˆ
            if (!locations[parentLocation]) {
                locations[parentLocation] = {};
            }
            if (!locations[parentLocation][detailLocation]) {
                locations[parentLocation][detailLocation] = [];
            }
            
            // ã‚¢ã‚¤ãƒ†ãƒ è¿½åŠ 
            const item = {
                id: Date.now(),
                name: itemName,
                memo: itemMemo,
                parent: parentLocation,
                detail: detailLocation,
                createdAt: new Date().toISOString()
            };
            
            items.push(item);
            locations[parentLocation][detailLocation].push(item);
            
            // å±¥æ­´ã«è¿½åŠ 
            history.push({
                action: 'add',
                item: item,
                timestamp: new Date().toISOString()
            });
            
            // ä¿å­˜
            saveData();
            
            // UIæ›´æ–°
            updateStats();
            renderTree();
            updateParentSelect();
            
            // ãƒ•ã‚©ãƒ¼ãƒ ã‚¯ãƒªã‚¢
            document.getElementById('detailLocation').value = '';
            document.getElementById('itemName').value = '';
            document.getElementById('itemMemo').value = '';
            document.getElementById('newParentLocation').value = '';
            
            alert('ã‚¢ã‚¤ãƒ†ãƒ ã‚’ç™»éŒ²ã—ã¾ã—ãŸï¼');
        }
        
        // ãƒ‡ãƒ¼ã‚¿ä¿å­˜
        function saveData() {
            localStorage.setItem('locations', JSON.stringify(locations));
            localStorage.setItem('items', JSON.stringify(items));
            localStorage.setItem('history', JSON.stringify(history));
        }
        
        // ãƒ„ãƒªãƒ¼è¡¨ç¤º
        function renderTree() {
            const treeView = document.getElementById('treeView');
            treeView.innerHTML = '';
            
            Object.keys(locations).forEach(parent => {
                const parentDiv = document.createElement('div');
                parentDiv.className = 'tree-item';
                parentDiv.innerHTML = `ğŸ“¦ ${parent}`;
                parentDiv.onclick = () => toggleChildren(parentDiv);
                
                const childrenDiv = document.createElement('div');
                childrenDiv.className = 'tree-children';
                childrenDiv.style.display = 'none';
                
                Object.keys(locations[parent]).forEach(detail => {
                    const detailDiv = document.createElement('div');
                    detailDiv.className = 'tree-item';
                    detailDiv.innerHTML = `ğŸ“ ${detail} (${locations[parent][detail].length}å€‹)`;
                    
                    const itemsDiv = document.createElement('div');
                    itemsDiv.className = 'tree-children';
                    itemsDiv.style.display = 'none';
                    
                    locations[parent][detail].forEach(item => {
                        const itemDiv = document.createElement('div');
                        itemDiv.className = 'tree-item';
                        itemDiv.innerHTML = `ğŸ“„ ${item.name} ${item.memo ? `(${item.memo})` : ''}`;
                        itemsDiv.appendChild(itemDiv);
                    });
                    
                    detailDiv.onclick = (e) => {
                        e.stopPropagation();
                        itemsDiv.style.display = itemsDiv.style.display === 'none' ? 'block' : 'none';
                    };
                    
                    detailDiv.appendChild(itemsDiv);
                    childrenDiv.appendChild(detailDiv);
                });
                
                parentDiv.appendChild(childrenDiv);
                treeView.appendChild(parentDiv);
            });
        }
        
        // å­è¦ç´ ã®è¡¨ç¤ºåˆ‡æ›¿
        function toggleChildren(element) {
            const children = element.querySelector('.tree-children');
            if (children) {
                children.style.display = children.style.display === 'none' ? 'block' : 'none';
            }
        }
        
        // ã‚¢ã‚¤ãƒ†ãƒ æ¤œç´¢
        function searchItems() {
            const query = document.getElementById('searchInput').value.toLowerCase();
            const resultsDiv = document.getElementById('searchResults');
            resultsDiv.innerHTML = '';
            
            if (!query) {
                return;
            }
            
            const results = items.filter(item => 
                item.name.toLowerCase().includes(query) || 
                (item.memo && item.memo.toLowerCase().includes(query))
            );
            
            if (results.length === 0) {
                resultsDiv.innerHTML = '<p>è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ</p>';
                return;
            }
            
            results.forEach(item => {
                const resultDiv = document.createElement('div');
                resultDiv.className = 'search-result';
                resultDiv.innerHTML = `
                    <strong>${item.name}</strong><br>
                    ğŸ“ ${item.parent} â†’ ${item.detail}<br>
                    ${item.memo ? `ğŸ“ ${item.memo}` : ''}
                `;
                resultsDiv.appendChild(resultDiv);
            });
            
            // æ¤œç´¢å±¥æ­´ã«è¿½åŠ 
            history.push({
                action: 'search',
                query: query,
                results: results.length,
                timestamp: new Date().toISOString()
            });
            saveData();
        }
        
        // QRã‚³ãƒ¼ãƒ‰ç”Ÿæˆ
        function generateQR() {
            const modal = document.getElementById('qrModal');
            modal.style.display = 'block';
            
            const qrContainer = document.getElementById('qrcode');
            qrContainer.innerHTML = '';
            
            const data = {
                locations: Object.keys(locations).length,
                items: items.length,
                url: window.location.href
            };
            
            new QRCode(qrContainer, {
                text: JSON.stringify(data),
                width: 200,
                height: 200
            });
        }
        
        // QRå°åˆ·
        function printQR() {
            window.print();
        }
        
        // SNSã‚·ã‚§ã‚¢
        function shareResults() {
            document.getElementById('shareModal').style.display = 'block';
        }
        
        function shareToTwitter() {
            const text = `${items.length}å€‹ã®ã‚¢ã‚¤ãƒ†ãƒ ã‚’æ•´ç†æ•´é “ï¼
æ¢ã—ç‰©ã®æ™‚é–“ã‚’${Math.floor(items.length * 3)}åˆ†ç¯€ç´„ã§ãã¾ã—ãŸâœ¨

ç„¡æ–™ã®æŒã¡ç‰©ãƒ­ã‚±ãƒ¼ã‚¿ãƒ¼ã§ã€Œã©ã“ã«ç½®ã„ãŸã£ã‘ï¼Ÿã€ã‚’è§£æ±ºï¼

#ç¶™ç¶šã¯åŠ›ãªã‚Š #æ•´ç†æ•´é “ #ç‰‡ä»˜ã‘ #ãƒ©ã‚¤ãƒ•ãƒãƒƒã‚¯`;
            
            const url = `https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(window.location.href)}`;
            window.open(url, '_blank');
        }
        
        function shareToLine() {
            const text = `${items.length}å€‹ã®ã‚¢ã‚¤ãƒ†ãƒ ã‚’æ•´ç†æ•´é “ï¼ç„¡æ–™ã®æŒã¡ç‰©ãƒ­ã‚±ãƒ¼ã‚¿ãƒ¼ã§æ¢ã—ç‰©ã‚¼ãƒ­ç”Ÿæ´»ã‚’å§‹ã‚ã‚ˆã†ï¼`;
            const url = `https://social-plugins.line.me/lineit/share?url=${encodeURIComponent(window.location.href)}&text=${encodeURIComponent(text)}`;
            window.open(url, '_blank');
        }
        
        function shareToFacebook() {
            const url = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(window.location.href)}`;
            window.open(url, '_blank');
        }
        
        // å‹é”ã¨æ¯”è¼ƒ
        function compareWithFriends() {
            document.getElementById('compareModal').style.display = 'block';
        }
        
        // å‹é”ã‚³ãƒ¼ãƒ‰ç”Ÿæˆ
        function generateFriendCode() {
            const code = 'IL' + Math.random().toString(36).substr(2, 6).toUpperCase();
            document.getElementById('friendCode').value = code;
        }
        
        // å‹é”ã‚³ãƒ¼ãƒ‰ã‚³ãƒ”ãƒ¼
        function copyFriendCode() {
            const codeInput = document.getElementById('friendCode');
            codeInput.select();
            document.execCommand('copy');
            alert('å‹é”ã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼');
        }
        
        // å±¥æ­´è¡¨ç¤º
        function showHistory() {
            const recentHistory = history.slice(-10).reverse();
            let historyText = 'æœ€è¿‘ã®å±¥æ­´ï¼š\n\n';
            
            recentHistory.forEach(h => {
                const date = new Date(h.timestamp).toLocaleString('ja-JP');
                if (h.action === 'add') {
                    historyText += `ğŸ“¦ ${date}: ${h.item.name}ã‚’ç™»éŒ²\n`;
                } else if (h.action === 'search') {
                    historyText += `ğŸ” ${date}: "${h.query}"ã‚’æ¤œç´¢ (${h.results}ä»¶)\n`;
                }
            });
            
            alert(historyText);
        }
        
        // ãƒ¢ãƒ¼ãƒ€ãƒ«é–‰ã˜ã‚‹
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }
        
        // ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼è¡¨ç¤º
        function showPrivacyPolicy() {
            document.getElementById('privacyModal').style.display = 'block';
        }
        
        // å…è²¬äº‹é …è¡¨ç¤º
        function showDisclaimer() {
            document.getElementById('disclaimerModal').style.display = 'block';
        }
        
        // ãŠå•ã„åˆã‚ã›è¡¨ç¤º
        function showContact() {
            document.getElementById('contactModal').style.display = 'block';
        }
        
        // ãŠå•ã„åˆã‚ã›é€ä¿¡
        function submitContact(e) {
            e.preventDefault();
            alert('ãŠå•ã„åˆã‚ã›ã‚’å—ã‘ä»˜ã‘ã¾ã—ãŸã€‚è¿”ä¿¡ã¾ã§2-3å–¶æ¥­æ—¥ãŠå¾…ã¡ãã ã•ã„ã€‚');
            closeModal('contactModal');
        }
        
        // ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°
        function trackAffiliate(type) {
            // ã“ã“ã«å®Ÿéš›ã®ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆãƒªãƒ³ã‚¯ã‚’è¨­å®š
            const affiliateLinks = {
                'muji': 'https://px.a8.net/svt/ejp?a8mat=XXXXX', // A8.netã®ç„¡å°è‰¯å“
                'ikea': 'https://hb.afl.rakuten.co.jp/XXXXX', // æ¥½å¤©ã®IKEA
                'label': 'https://www.amazon.co.jp/dp/XXXXX?tag=XXXXX' // Amazonã®ãƒ©ãƒ™ãƒ«ãƒ—ãƒªãƒ³ã‚¿ãƒ¼
            };
            
            if (affiliateLinks[type]) {
                window.open(affiliateLinks[type], '_blank');
            }
        }
        
        // Enterã‚­ãƒ¼ã§æ¤œç´¢
        document.getElementById('searchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchItems();
            }
        });
        
        // ãƒ¢ãƒ¼ãƒ€ãƒ«å¤–ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
            }
        }
        
        // åˆæœŸåŒ–å®Ÿè¡Œ
        init();
    </script>
</body>
</html>